<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather App</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>

  <body
    id="body"
    class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-indigo-200"
  >
    <main class="w-full max-w-md px-4 py-6">

      <form class="flex gap-2 mb-6">
        <input
          id="city-input"
          type="text"
          placeholder="Search city"
          class="flex-1 px-4 py-2 rounded-xl bg-white/80 outline-none text-gray-700 text-sm shadow-md"
        />
        <button
          type="submit"
          onclick="fetchWeatherData(event)"
          class="bg-blue-500 backdrop-blur-md text-white px-4 py-2 rounded-xl shadow-md hover:bg-blue-400 cursor-pointer transition"
        >
          Search
        </button>
      </form>

      <div
        id="weather-card"
        class="bg-white/20 backdrop-blur-lg rounded-2xl shadow-2xl p-6 text-white border border-white/30 hidden"
      >
        <div class="text-center mb-4">
          <h1 id="city-name" class="text-2xl sm:text-3xl font-bold"></h1>
          <p id="region-country" class="text-sm opacity-80"></p>
          <p id="local-time" class="text-xs opacity-70 mt-1"></p>
        </div>

        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 id="temperature" class="text-4xl sm:text-5xl font-extrabold"></h2>
            <p id="condition-text" class="text-md mt-1 opacity-90"></p>
          </div>
          <img id="weather-icon" class="w-16 h-16 sm:w-20 sm:h-20" />
        </div>

        <div class="grid grid-cols-2 gap-3 text-sm">
          <div class="bg-white/10 p-3 rounded-lg">
            <p class="opacity-70">Feels Like</p>
            <p id="feels-like" class="font-semibold text-lg"></p>
          </div>

          <div class="bg-white/10 p-3 rounded-lg">
            <p class="opacity-70">Humidity</p>
            <p id="humidity" class="font-semibold text-lg"></p>
          </div>

          <div class="bg-white/10 p-3 rounded-lg">
            <p class="opacity-70">Wind</p>
            <p id="wind" class="font-semibold text-lg"></p>
          </div>

          <div class="bg-white/10 p-3 rounded-lg">
            <p class="opacity-70">Pressure</p>
            <p id="pressure" class="font-semibold text-lg"></p>
          </div>
        </div>
      </div>
      <div id="loader" class="flex justify-center items-center hidden">
        <div
          class="w-10 h-10 border-4 border-white/40 border-t-white rounded-full animate-spin"
        ></div>
      </div>

    </main>

    <script>
      function setTheme(isDay) {
        const body = document.getElementById("body");

        if (isDay) {
          body.className =
            "min-h-screen flex items-center justify-center transition-all duration-500 bg-gradient-to-br from-blue-400 via-sky-500 to-indigo-600";
        } else {
          body.className =
            "min-h-screen flex items-center justify-center transition-all duration-500 bg-gradient-to-br from-gray-900 via-indigo-900 to-black";
        }
      }

      function fetchWeatherData(event) {
        event.preventDefault();

        const cityInput = document.getElementById("city-input");
        const city = cityInput.value.trim();

        if (!city) return;

        const loader = document.getElementById("loader");
        const card = document.getElementById("weather-card");

        card.classList.add("hidden");
        loader.classList.remove("hidden");

        fetch(`http://localhost:3000/currweather?city=${city}`)
          .then((res) => res.json())
          .then((data) => {
            setTheme(data.current.is_day === 1);
            // Location
            document.getElementById("city-name").innerText = data.location.name;
            document.getElementById("region-country").innerText =
              `${data.location.region}, ${data.location.country}`;
            document.getElementById("local-time").innerText =
              `Local Time: ${data.location.localtime}`;

            // Temperature
            document.getElementById("temperature").innerText =
              `${data.current.temp_c}°C`;
            document.getElementById("condition-text").innerText =
              data.current.condition.text;
            document.getElementById("weather-icon").src =
              "https:" + data.current.condition.icon;

            // Details
            document.getElementById("feels-like").innerText =
              `${data.current.feelslike_c}°C`;
            document.getElementById("humidity").innerText =
              `${data.current.humidity}%`;
            document.getElementById("wind").innerText =
              `${data.current.wind_kph} kph (${data.current.wind_dir})`;
            document.getElementById("pressure").innerText =
              `${data.current.pressure_mb} mb`;

            loader.classList.add("hidden");
            card.classList.remove("hidden");
          })
          .catch((err) => {
            loader.classList.add("hidden");
            alert("City not found or server error.");
            console.error(err);
          });
      }
    </script>
  </body>
</html>
